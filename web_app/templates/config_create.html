{% extends "base.html" %}

{% block title %}鏂板缓閰嶇疆鏂囦欢 - 鑷姩鍖栬繍缁村伐鍏穥% endblock %}

{% block content %}
<h2>鏂板缓閰嶇疆鏂囦欢</h2>

<div class="config-create-actions">
    <a href="{{ url_for('config') }}" class="btn btn-secondary">杩斿洖閰嶇疆绠＄悊</a>
</div>

<form id="create-config-form" method="POST">
    <div class="form-group">
        <label for="filename">鏂囦欢鍚?</label>
        <input type="text" id="filename" name="filename" class="form-control" required>
        <small class="form-text">璇疯緭鍏ユ枃浠跺悕锛屼緥濡? config.json 鎴?rules.yaml</small>
    </div>
    
    <div class="form-group">
        <label for="file_type">鏂囦欢绫诲瀷:</label>
        <select id="file_type" name="file_type">
            <option value="TEXT">鏂囨湰</option>
            <option value="JSON">JSON</option>
            <option value="YAML">YAML</option>
        </select>
    </div>
    
    <div class="form-group">
        <label for="content">鏂囦欢鍐呭:</label>
        <textarea id="content" name="content" rows="15" class="form-control"></textarea>
    </div>
    
    <div class="form-actions">
        <button type="submit" class="btn btn-primary">鍒涘缓閰嶇疆鏂囦欢</button>
        <button type="button" class="btn btn-secondary" onclick="history.back()">鍙栨秷</button>
    </div>
</form>

<div id="create-result" class="save-result" style="display: none;"></div>
{% endblock %}

{% block extra_css %}
<style>
.config-create-actions {
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.form-control {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-family: 'Courier New', Courier, monospace;
    font-size: 14px;
}

.form-text {
    color: #6c757d;
    font-size: 0.875em;
}

.form-actions {
    margin-top: 20px;
}

.save-result {
    margin-top: 15px;
    padding: 10px;
    border-radius: 4px;
}

.save-result.success {
    background-color: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
}

.save-result.error {
    background-color: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('create-config-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = e.target;
    const formData = new FormData(form);
    
    fetch(form.action, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        const resultDiv = document.getElementById('create-result');
        resultDiv.style.display = 'block';
        
        if (data.success) {
            resultDiv.className = 'save-result success';
            resultDiv.innerHTML = '<strong>鎴愬姛:</strong> ' + data.message;
            
            // 鍒涘缓鎴愬姛鍚?绉掕烦杞埌閰嶇疆绠＄悊椤甸潰
            setTimeout(() => {
                window.location.href = "{{ url_for('config') }}";
            }, 2000);
        } else {
            resultDiv.className = 'save-result error';
            resultDiv.innerHTML = '<strong>閿欒:</strong> ' + data.message;
        }
        
        // 3绉掑悗鑷姩闅愯棌缁撴灉鎻愮ず
        setTimeout(() => {
            resultDiv.style.display = 'none';
        }, 3000);
    })
    .catch(error => {
        const resultDiv = document.getElementById('create-result');
        resultDiv.style.display = 'block';
        resultDiv.className = 'save-result error';
        resultDiv.innerHTML = '<strong>閿欒:</strong> 鍒涘缓閰嶇疆鏂囦欢鏃跺彂鐢熼敊璇? ' + error.message;
        
        // 3绉掑悗鑷姩闅愯棌缁撴灉鎻愮ず
        setTimeout(() => {
            resultDiv.style.display = 'none';
        }, 3000);
    });
});
</script>
{% endblock %}